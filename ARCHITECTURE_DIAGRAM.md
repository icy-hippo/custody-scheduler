# Calendar Export Architecture

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     HARMONYHUB APPLICATION                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              ParentDashboard (Updated)                   â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  [Add Event] [Custody Setup] [Family] [Link Parent]      â”‚  â”‚
â”‚  â”‚  [ðŸ“¥ Export Calendar] â† NEW BUTTON                       â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                 â”‚                                                â”‚
â”‚                 â”‚ Triggers                                       â”‚
â”‚                 â–¼                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         CalendarExport Component (NEW)                   â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  Modal Dialog                                             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Export Calendar                                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  ðŸ“… Family Events                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  [Download]  [Copy]                               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  ðŸ  Custody Schedule                              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  [Download]  [Copy]                               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  âœ¨ Complete Calendar                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  [Download All]                                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                     â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚              â”‚                      â”‚                      â”‚  â”‚
â”‚  â”‚      Download/Copy Click            â”‚                      â”‚  â”‚
â”‚  â”‚              â”‚                      â”‚                      â”‚  â”‚
â”‚  â”‚              â–¼                      â”‚                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚                      â”‚  â”‚
â”‚  â”‚  â”‚ generateEventsIcal() â”‚           â”‚                      â”‚  â”‚
â”‚  â”‚  â”‚ generateCustodyIcal()â”‚           â”‚                      â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚                      â”‚  â”‚
â”‚  â”‚              â”‚                      â”‚                      â”‚  â”‚
â”‚  â”‚              â–¼                      â–¼                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚  â”‚
â”‚  â”‚  â”‚ downloadIcalFile()   â”‚  â”‚copyIcalToClipboard() â”‚      â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚  â”‚
â”‚  â”‚              â”‚                      â”‚                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                 â”‚                      â”‚                         â”‚
â”‚                 â–¼                      â–¼                         â”‚
â”‚        [Download .ics File]     [Copy to Clipboard]            â”‚
â”‚                 â”‚                      â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                      â”‚
                  â–¼                      â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Calendar Apps   â”‚   â”‚  Calendar Apps   â”‚
        â”‚  (Download Flow) â”‚   â”‚  (Paste Flow)    â”‚
        â”‚                  â”‚   â”‚                  â”‚
        â”‚ - Google Cal     â”‚   â”‚ - Google Cal     â”‚
        â”‚ - Apple Cal      â”‚   â”‚ - Apple Cal      â”‚
        â”‚ - Outlook        â”‚   â”‚ - Outlook        â”‚
        â”‚ - Others...      â”‚   â”‚ - Others...      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FIREBASE DATABASE                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  Collections:                                                    â”‚
â”‚  - events/                                                       â”‚
â”‚    â”œâ”€â”€ title, date, time, location, notes, category            â”‚
â”‚    â”œâ”€â”€ color, icon, createdBy, familyId                        â”‚
â”‚                                                                   â”‚
â”‚  - custody/ (indexed by userId)                                 â”‚
â”‚    â”œâ”€â”€ pattern (alternating-weeks, 2-2-3, weekday-weekend)     â”‚
â”‚    â”œâ”€â”€ startDate                                                â”‚
â”‚    â””â”€â”€ parent1Name, parent2Name                                 â”‚
â”‚                                                                   â”‚
â”‚  - users/                                                        â”‚
â”‚    â”œâ”€â”€ familyId                                                 â”‚
â”‚    â””â”€â”€ linkedParentId                                           â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚              â”‚
        Read (no modifications)        â”‚
                        â”‚              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            CalendarExportService (src/services/)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ generateEventsIcal(events[], familyName)                â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  For each event:                                       â”‚   â”‚
â”‚  â”‚  1. Generate unique UID                                â”‚   â”‚
â”‚  â”‚  2. Format date/time to iCal format                    â”‚   â”‚
â”‚  â”‚  3. Escape special characters                          â”‚   â”‚
â”‚  â”‚  4. Build VEVENT block                                 â”‚   â”‚
â”‚  â”‚  5. Combine into VCALENDAR                             â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Returns: iCal formatted string                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ generateCustodyIcal(schedule, months)                  â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  1. Parse custody schedule                            â”‚   â”‚
â”‚  â”‚  2. Generate events for date range                     â”‚   â”‚
â”‚  â”‚  3. For each day:                                      â”‚   â”‚
â”‚  â”‚     - Determine which parent has custody              â”‚   â”‚
â”‚  â”‚     - Create continuous event blocks                   â”‚   â”‚
â”‚  â”‚  4. Build VEVENT blocks                                â”‚   â”‚
â”‚  â”‚  5. Combine into VCALENDAR                             â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Returns: iCal formatted string                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Helper Functions                                         â”‚   â”‚
â”‚  â”‚ - formatDateTimeForIcal()                              â”‚   â”‚
â”‚  â”‚ - formatDateForIcal()                                  â”‚   â”‚
â”‚  â”‚ - escapeIcalText()                                     â”‚   â”‚
â”‚  â”‚ - generateUID()                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        iCal formatted      â”‚
        string (valid      â”‚
        according to       â”‚
        RFC 5545)          â”‚
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                      â”‚
        â–¼                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ downloadIcalFile()   â”‚              â”‚copyIcalToClipboard() â”‚
â”‚                      â”‚              â”‚                      â”‚
â”‚ 1. Create Blob       â”‚              â”‚ 1. Use Clipboard API â”‚
â”‚ 2. Set MIME type     â”‚              â”‚ 2. Copy text         â”‚
â”‚ 3. Create download   â”‚              â”‚ 3. Return promise    â”‚
â”‚    link              â”‚              â”‚                      â”‚
â”‚ 4. Trigger click     â”‚              â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                      â”‚
        â–¼                                      â–¼
   Download .ics                    Clipboard contents
   File to disk                      (user can paste)
```

## Component Interaction Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ParentDashboard                              â”‚
â”‚                                                                  â”‚
â”‚  State:                                                         â”‚
â”‚  - events: Event[]         (from Firebase)                     â”‚
â”‚  - custodySchedule: Object (from Firebase)                     â”‚
â”‚  - user: User              (from Auth)                         â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ Pass props
                     â”‚
                     â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  CalendarExport      â”‚
           â”‚  Component (NEW)     â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
           â”‚                      â”‚
           â”‚ Props:               â”‚
           â”‚ - events             â”‚
           â”‚ - custodySchedule    â”‚
           â”‚                      â”‚
           â”‚ State:               â”‚
           â”‚ - showModal          â”‚
           â”‚ - copied             â”‚
           â”‚                      â”‚
           â”‚ Methods:             â”‚
           â”‚ - handleExport()     â”‚
           â”‚ - handleCopyClick()  â”‚
           â”‚                      â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚            â”‚            â”‚
        â”‚ Import     â”‚ Import     â”‚
        â”‚            â”‚            â”‚
        â–¼            â–¼            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚generate      â”‚ â”‚download      â”‚ â”‚copyIcal      â”‚
â”‚EventsIcal    â”‚ â”‚IcalFile      â”‚ â”‚ToClipboard   â”‚
â”‚              â”‚ â”‚              â”‚ â”‚              â”‚
â”‚from Service  â”‚ â”‚from Service  â”‚ â”‚from Service  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## iCal File Structure

```
BEGIN:VCALENDAR
â”œâ”€ VERSION:2.0
â”œâ”€ PRODID:-//HarmonyHub//Custody Scheduler//EN
â”œâ”€ CALSCALE:GREGORIAN
â”œâ”€ METHOD:PUBLISH
â”œâ”€ X-WR-CALNAME:Family Schedule
â”œâ”€ X-WR-TIMEZONE:UTC
â”œâ”€ DESCRIPTION:Custody and Family Schedule
â”‚
â”œâ”€ BEGIN:VEVENT (Event 1)
â”‚  â”œâ”€ UID:1708100000000-abc123def@harmonyhub.local
â”‚  â”œâ”€ DTSTAMP:20260217T143000Z
â”‚  â”œâ”€ DTSTART:20260301T153000
â”‚  â”œâ”€ SUMMARY:Soccer Practice
â”‚  â”œâ”€ LOCATION:Central Park
â”‚  â”œâ”€ DESCRIPTION:Bring water bottle
â”‚  â”œâ”€ CATEGORIES:Sports
â”‚  â””â”€ END:VEVENT
â”‚
â”œâ”€ BEGIN:VEVENT (Event 2)
â”‚  â”œâ”€ UID:1708100010000-def456ghi@harmonyhub.local
â”‚  â”œâ”€ DTSTAMP:20260217T143000Z
â”‚  â”œâ”€ DTSTART;VALUE=DATE:20260302
â”‚  â”œâ”€ SUMMARY:School Pickup
â”‚  â”œâ”€ CATEGORIES:School
â”‚  â””â”€ END:VEVENT
â”‚
â”œâ”€ BEGIN:VEVENT (Custody 1)
â”‚  â”œâ”€ UID:1708100020000-ghi789jkl@harmonyhub.local
â”‚  â”œâ”€ DTSTAMP:20260217T143000Z
â”‚  â”œâ”€ DTSTART;VALUE=DATE:20260301
â”‚  â”œâ”€ DTEND;VALUE=DATE:20260307
â”‚  â”œâ”€ SUMMARY:ðŸ“… With Mom
â”‚  â”œâ”€ DESCRIPTION:Custody with Mom
â”‚  â”œâ”€ TRANSP:TRANSPARENT
â”‚  â””â”€ END:VEVENT
â”‚
â””â”€ END:VCALENDAR
```

## Export Workflow Sequence

```
User clicks                   CalendarExport
"Export Calendar"             Component
        â”‚                            â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ Open Modal
        â”‚                            â”‚
        â”‚ Select                     â”‚
        â”‚ "Family Events"            â”‚
        â”‚                            â”‚
        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Show selected
        â”‚                            â”‚
        â”‚ Click "Download"           â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ handleExport()
        â”‚                            â”‚
        â”‚                            â”œâ”€> generateEventsIcal()
        â”‚                            â”‚   â”‚
        â”‚                            â”‚   â””â”€> iCal string
        â”‚                            â”‚
        â”‚                            â”œâ”€> downloadIcalFile()
        â”‚                            â”‚   â”‚
        â”‚                            â”‚   â”œâ”€> Create Blob
        â”‚                            â”‚   â”œâ”€> Create link
        â”‚                            â”‚   â””â”€> Trigger download
        â”‚                            â”‚
        â”‚<â”€â”€â”€ "family-events.ics" â”€â”€â”€â”¤
        â”‚
    Browser downloads file
    to Downloads folder
        â”‚
        â–¼
    User imports to
    calendar app
```

## Error Handling Flow

```
                    Export Initiated
                            â”‚
                            â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Validate Input Data     â”‚
              â”‚ - events not empty      â”‚
              â”‚ - custody schedule ok   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                     â”‚
      No Error              Has Error
            â”‚                     â”‚
            â–¼                     â–¼
     Generate iCal         Log Error
            â”‚              Alert User
            â”‚              Return
      Download/Copy
            â”‚
            â–¼
      Success/Fail
            â”‚
      â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
      â”‚           â”‚
    Success    Failure
      â”‚           â”‚
      â–¼           â–¼
    âœ“ Done   Show Error Message
```

## Integration with Existing Systems

```
HarmonyHub Application
â”‚
â”œâ”€ Firebase Backend
â”‚  â”œâ”€ Authentication (auth.js)
â”‚  â”œâ”€ Firestore Database (firebase.js)
â”‚  â”‚  â”œâ”€ events collection â†’ generateEventsIcal()
â”‚  â”‚  â”œâ”€ custody collection â†’ generateCustodyIcal()
â”‚  â”‚  â””â”€ users collection
â”‚  â””â”€ Storage
â”‚
â”œâ”€ React Components
â”‚  â”œâ”€ ParentDashboard (UPDATED)
â”‚  â”‚  â””â”€ imports CalendarExport
â”‚  â”‚
â”‚  â”œâ”€ CalendarExport (NEW)
â”‚  â”‚  â””â”€ imports CalendarExportService
â”‚  â”‚
â”‚  â”œâ”€ ChildDashboard (not changed)
â”‚  â”œâ”€ AddEvent (not changed)
â”‚  â””â”€ other components...
â”‚
â”œâ”€ Services
â”‚  â”œâ”€ CalendarExportService (NEW)
â”‚  â”‚  â””â”€ Pure functions, no side effects
â”‚  â”‚
â”‚  â”œâ”€ NotificationService
â”‚  â””â”€ other services...
â”‚
â””â”€ Context
   â”œâ”€ DarkModeContext
   â””â”€ other contexts...
```

---

**Note:** This architecture ensures:
- âœ… Separation of concerns (Service vs Component)
- âœ… Reusability (Service can be used anywhere)
- âœ… Testability (Pure functions)
- âœ… Maintainability (Clear structure)
- âœ… No breaking changes (Only additions)
